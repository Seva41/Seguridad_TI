#include <stdio.h>
#include <stdlib.h>
#include <time.h>

void my_usleep(unsigned int usec);

int main()
{
    printf("¡Has sido infectado por un malware!\n");
    printf("Tu sistema ha sido comprometido.\n");
    printf("Encriptando tus archivos...\n");

    // Espera de 2 segundos usando la función personalizada
    my_usleep(2000000); // Para Linux y Mac

    printf("Solo bromeo, no te preocupes.\n");
    printf("No se ha hecho ningún daño real.\n");

    // Genera una contraseña
    char *password = "o$CTF4_pass&"; // Reemplaza esto con tu contraseña

    // Crea un archivo de texto con la contraseña en el mismo directorio
    FILE *archivo = fopen("contrasena.txt", "w");
    if (archivo == NULL)
    {
        perror("Error al crear el archivo");
        return 1;
    }

    fprintf(archivo, "%s\n", password);
    fclose(archivo);

    // printf("Se ha creado un archivo 'contrasena.txt' con la contraseña.\n");

    return 0;
}

void my_usleep(unsigned int usec)
{
    clock_t start_time = clock();
    clock_t end_time = start_time + (usec * CLOCKS_PER_SEC / 1000000);

    while (clock() < end_time)
    {
        // No hace nada, solo espera
    }
}
